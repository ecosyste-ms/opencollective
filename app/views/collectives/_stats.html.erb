<div class='row'>
  <div class='col-md-3'>
    <%= open_issues %>
  </div>
  <div class='col-md-3'>
    <%= render_stats(:open_pull_requests, title: 'New Pull Requests', icon: 'git-pull-request') %>
  </div>
  <div class='col-md-3'>
    <!-- closed issues -->
    <%= render_stats(:closed_issues, title: 'Closed Issues', icon: 'issue-closed') %>
  </div>
  <div class='col-md-3'>
    <!-- prs merged -->
    <% @merged_prs = @collective.issues.pull_request.merged_this_period(@range).count %>
    <% @merged_prs_last_period = @collective.issues.pull_request.merged_last_period(@range).count %>
    <%= render partial: 'stat', locals: {icon: 'git-merge', title: 'Merged Pull Requests', this_period: @merged_prs, last_period: @merged_prs_last_period} %>
  </div>
</div>


<div class='row'>
  <div class='col-md-3'>
    <!-- # prs closed -->
    <% @closed_prs = @collective.issues.pull_request.closed_this_period(@range).count %>
    <% @closed_prs_last_period = @collective.issues.pull_request.closed_last_period(@range).count %>
    <%= render partial: 'stat', locals: {icon: 'git-pull-request', title: 'Closed Pull Requests', this_period: @closed_prs, last_period: @closed_prs_last_period} %>

  </div>
  <div class='col-md-3'>
    <!-- # issue authors -->
    <% @issue_authors = @collective.issues.issue.this_period(@range).group(:user).count.count %>
    <% @issue_authors_last_period = @collective.issues.issue.last_period(@range).group(:user).count.count %>
    <%= render partial: 'stat', locals: {icon: 'person', title: 'Issue Authors', this_period: @issue_authors, last_period: @issue_authors_last_period} %>
  </div>
  <div class='col-md-3'>
    <!-- # issues average time to close -->
    <% @avg_issue_time_to_close = @collective.issues.issue.this_period(@range).average(:time_to_close).to_i %>
    <% @avg_issue_time_to_close_last_period = @collective.issues.issue.last_period(@range).average(:time_to_close).to_i %>
    <%= render partial: 'time_stat', locals: {icon: 'clock', title: 'Time-to-Close Issues', this_period: @avg_issue_time_to_close, last_period: @avg_issue_time_to_close_last_period} %>
  </div>
  <div class='col-md-3'>
    <!-- # prs not merged -->
    <% @not_merged_prs = @collective.issues.pull_request.not_merged_this_period(@range).count %>
    <% @not_merged_prs_last_period = @collective.issues.pull_request.not_merged_last_period(@range).count %>
    <%= render partial: 'stat', locals: {icon: 'git-pull-request', title: 'Not Merged PRs', this_period: @not_merged_prs, last_period: @not_merged_prs_last_period, positive_diff_change: -1} %>
  </div>
</div>

<div class='row'>
  <div class='col-md-3'>
    <!-- # prs authors -->
    <% @pr_authors = @collective.issues.pull_request.this_period(@range).group(:user).count.count %>
    <% @pr_authors_last_period = @collective.issues.pull_request.last_period(@range).group(:user).count.count %>
    <%= render partial: 'stat', locals: {icon: 'person', title: 'Pull Request Authors', this_period: @pr_authors, last_period: @pr_authors_last_period} %>
  </div>
  <div class='col-md-3'>
    <!-- # prs average time to close -->
    <% @avg_pr_time_to_close = @collective.issues.pull_request.this_period(@range).average(:time_to_close).to_i %>
    <% @avg_pr_time_to_close_last_period = @collective.issues.pull_request.last_period(@range).average(:time_to_close).to_i %>
    <%= render partial: 'time_stat', locals: {icon: 'clock', title: 'Time-to-Close PRs', this_period: @avg_pr_time_to_close, last_period: @avg_pr_time_to_close_last_period} %>
  </div>
  <div class='col-md-3'>
    <!-- # prs average time to merge -->
    <% @avg_pr_time_to_merge = @collective.issues.pull_request.merged.this_period(@range).average(:time_to_close).to_i %>
    <% @avg_pr_time_to_merge_last_period = @collective.issues.pull_request.merged.last_period(@range).average(:time_to_close).to_i %>
    <%= render partial: 'time_stat', locals: {icon: 'clock', title: 'Time-to-Merge PRs', this_period: @avg_pr_time_to_merge, last_period: @avg_pr_time_to_merge_last_period} %>
  </div>
  <div class='col-md-3'>
    <!-- # maintainers -->
    <% @maintainers = @collective.issues.maintainers.this_period(@range).group(:user).count.count %>
    <% @maintainers_last_period = @collective.issues.maintainers.last_period(@range).group(:user).count.count %>
    <%= render partial: 'stat', locals: {icon: 'passkey-fill', title: 'Maintainers', this_period: @maintainers, last_period: @maintainers_last_period} %>
  </div>
</div>

<% if @collective.transactions.any? %>
<div class='row'>
  <div class='col-md-3'>
    <!-- # donations -->
    <% @donations = @collective.transactions.donations.this_period(@range).sum(:net_amount) %>
    <% @donations_last_period = @collective.transactions.donations.last_period(@range).sum(:net_amount) %>
    <%= render partial: 'money_stat', locals: {icon: 'gift', title: 'Donations', this_period: @donations, last_period: @donations_last_period} %>
  </div>
  <div class='col-md-3'>
    <!-- # expenses -->
    <% @expenses = @collective.transactions.expenses.this_period(@range).sum(:net_amount) %>
    <% @expenses_last_period = @collective.transactions.expenses.last_period(@range).sum(:net_amount) %>
    <%= render partial: 'money_stat', locals: {icon: 'credit-card', title: 'Expenses', this_period: @expenses, last_period: @expenses_last_period} %>
  </div>
  <div class='col-md-3'>
    <!-- # donors -->
    <% @donors = @collective.transactions.donations.this_period(@range).distinct.count(:account) %>
    <% @donors_last_period = @collective.transactions.donations.last_period(@range).distinct.count(:account) %>
    <%= render partial: 'stat', locals: {icon: 'person', title: 'Donors', this_period: @donors, last_period: @donors_last_period} %>
  </div>
  <div class='col-md-3'>
    <!-- # spenders -->
    <% @spenders = @collective.transactions.expenses.this_period(@range).distinct.count(:account) %>
    <% @spenders_last_period = @collective.transactions.expenses.last_period(@range).distinct.count(:account) %>
    <%= render partial: 'stat', locals: {icon: 'person', title: 'Spenders', this_period: @spenders, last_period: @spenders_last_period} %>
  </div>
</div>
<% end %>

<% if @collective.commits.any? %>
  <div class='row'>
    <div class='col-md-3'>
      <!-- # commits -->
      <% @commits = @collective.commits.this_period(@range).count %>
      <% @commits_last_period = @collective.commits.last_period(@range).count %>
      <%= render partial: 'stat', locals: {icon: 'git-commit', title: 'Commits', this_period: @commits, last_period: @commits_last_period} %>
    </div>
    <div class='col-md-3'>
      <!-- # merges -->
      <% @merges = @collective.commits.merges.this_period(@range).count %>
      <% @merges_last_period = @collective.commits.merges.last_period(@range).count %>
      <%= render partial: 'stat', locals: {icon: 'git-merge', title: 'Merge Commits', this_period: @merges, last_period: @merges_last_period} %>
    </div>
    <div class='col-md-3'>
      <!-- # authors -->
      <% @authors = @collective.commits.this_period(@range).distinct.count(:author) %>
      <% @authors_last_period = @collective.commits.last_period(@range).distinct.count(:author) %>
      <%= render partial: 'stat', locals: {icon: 'person', title: 'Authors', this_period: @authors, last_period: @authors_last_period} %>
    </div>
    <div class='col-md-3'>
      <!-- # committers -->
      <% @committers = @collective.commits.this_period(@range).distinct.count(:committer) %>
      <% @committers_last_period = @collective.commits.last_period(@range).distinct.count(:committer) %>
      <%= render partial: 'stat', locals: {icon: 'person', title: 'Committers', this_period: @committers, last_period: @committers_last_period} %>
    </div>
  </div>

  <div class='row'>
    <div class='col-md-3'>
      <!-- # additions -->
      <% @additions = @collective.commits.this_period(@range).sum(:additions) %>
      <% @additions_last_period = @collective.commits.last_period(@range).sum(:additions) %>
      <%= render partial: 'stat', locals: {icon: 'plus', title: 'Additions', this_period: @additions, last_period: @additions_last_period} %>
    </div>
    <div class='col-md-3'>
      <!-- # deletions -->
      <% @deletions = @collective.commits.this_period(@range).sum(:deletions) %>
      <% @deletions_last_period = @collective.commits.last_period(@range).sum(:deletions) %>
      <%= render partial: 'stat', locals: {icon: 'dash', title: 'Deletions', this_period: @deletions, last_period: @deletions_last_period} %>
    </div>
  </div>
<% end %>

<% if @collective.tags.any? %>
  <div class='row'>
    <div class='col-md-3'>
      <!-- # releases -->
      <% @releases = @collective.tags.this_period(@range).count %>
      <% @releases_last_period = @collective.tags.last_period(@range).count %>
      <%= render partial: 'stat', locals: {icon: 'tag', title: 'Releases', this_period: @releases, last_period: @releases_last_period} %>
    </div>
  </div>
<% end %>