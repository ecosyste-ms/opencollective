<% @meta_title = "#{@collective}" %>

<div class="container-md">
    <%= render 'nav' %>

  <h1>
    <%= @collective.to_s %>
  </h1>

  <p>
    <%= @collective.description %> <br/>
    <% if @collective.account_type %>
    <%= @collective.account_type.humanize %> -
    <% end %>
    <%= link_to @collective.html_url, @collective.html_url, target: :_blank %>
    <% if @collective.website.present? && @collective.website != @collective.project_url %>
    - 
    Website: <%= link_to @collective.website, @collective.website, target: :_blank %>
    <% end %>
    <% if @collective.project_url.present? %>
    - 
    Code: <%= link_to @collective.project_url, @collective.project_url, target: :_blank %>
    <% end %>
  </p>

  <%= form_with url: request.path, method: :get do |form| %>
    <%= form.label :range, 'Select range:' %>
    <%= form.select :range, options_for_select([30, 90, 180, 360], @range.to_i), {}, { onchange: 'this.form.submit()' } %>
  <% end %><br/>

  <%= render 'stats' %>

  <%= render 'audit' %>

  <h2>Transactions</h2>

  <% if @transactions %>

    <%= line_chart chart_data_collective_path(chart: 'all_transactions', period: @period, range: @range), title: 'All Transactions' %>
    <%= line_chart chart_data_collective_path(chart: 'expenses', period: @period, range: @range), title: 'Expenses' %>
    <%= line_chart chart_data_collective_path(chart: 'donations', period: @period, range: @range), title: 'Donations' %>
    <%= line_chart chart_data_collective_path(chart: 'unique_donors', period: @period, range: @range), title: 'Donors' %>
    <%= line_chart chart_data_collective_path(chart: 'unique_expenses', period: @period, range: @range), title: 'Spenders' %>

  <% else %>
    <p>
      No transactions in this period.
    </p>
  <% end %>

  <% if @collective.issues.count > 0 %>
    <h2>Issues</h2>

    <%= render 'issue_charts' %>
  <% else %>
    <p>
      No issues or pull requests yet.
    </p>
  <% end %>

  <% if @projects.any? %>
    <h2>Key Repositories</h2>
    <%= render @collective.key_projects %>

    <% if (@projects - @collective.key_projects).length > 0 %>
      <h2>Other Repositories</h2>

      <%= render @projects - @collective.key_projects %>
      <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>  
    <% end %>
  <% else %>
    <p>
      No repositories found.
    </p>
  <% end %>

</div>