<% @meta_title = "#{@collective}" %>

<div class="container-md">
    <%= render 'nav' %>

  <h1>
    <%= @collective.to_s %>
  </h1>

  <p>
    <%= @collective.description %> <br/>
    <% if @collective.account_type %>
      <%= @collective.account_type.humanize %> -
    <% end %>
    <% if @collective.host.present? %>
      Host: <%= link_to @collective.host, "https://opencollective.com/#{@collective.host}" %> -
    <% end %>
    <%= link_to @collective.html_url, @collective.html_url, target: :_blank %>
    <% if @collective.website.present? && @collective.website != @collective.project_url %>
      - Website: <%= link_to @collective.website, @collective.website, target: :_blank %>
    <% end %>
    <% if @collective.project_url.present? %>
      -  Code: <%= link_to @collective.project_url, @collective.project_url, target: :_blank %>
    <% end %>
  </p>

  <%= form_with url: request.path, method: :get do |form| %>
    <%= form.label :range, 'Select range:' %>
    <%= form.select :range, options_for_select([30, 90, 180, 360], @range.to_i), {}, { onchange: 'this.form.submit()' } %>
  <% end %><br/>

  <% if @collective.host == 'opensource' %>
    <%= render 'stats' %>
    <%= render 'audit' %>
  <% end %>

  <h2>Transactions</h2>

  <% if @transactions %>
    <div class='row'>
      <div class='col-md-6'>
        <%= pie_chart transactions_chart_path(collective_slugs: @collective.slug, chart: 'donor_pie', period: @period, range: @range), title: 'Top Donors', donut: true, legend: 'left', thousands: "," , zeros: true, prefix: "$" %>
      </div>
      <div class='col-md-6'>
        <%= pie_chart transactions_chart_path(collective_slugs: @collective.slug, chart: 'spenders_pie', period: @period, range: @range), title: 'Top Spenders', donut: true, legend: 'left', thousands: ",", zeros: true, prefix: "$" %>
      </div>
    </div>
    
    <%= line_chart transactions_chart_path(collective_slugs: @collective.slug, chart: 'all_transactions', period: @period, range: @range), title: 'All Transactions', thousands: ",", zeros: true, prefix: "$" %>
    <%= line_chart transactions_chart_path(collective_slugs: @collective.slug, chart: 'expenses', period: @period, range: @range), title: 'Expenses', thousands: ",", zeros: true, prefix: "$" %>
    <%= line_chart transactions_chart_path(collective_slugs: @collective.slug, chart: 'donations', period: @period, range: @range), title: 'Donations', thousands: ",", zeros: true, prefix: "$" %>
    <%= line_chart transactions_chart_path(collective_slugs: @collective.slug, chart: 'unique_donors', period: @period, range: @range), title: 'Donors', thousands: "," %>
    <%= line_chart transactions_chart_path(collective_slugs: @collective.slug, chart: 'unique_expenses', period: @period, range: @range), title: 'Spenders', thousands: "," %>

  <% else %>
    <p>
      No transactions in this period.
    </p>
  <% end %>
  
  <% if @collective.host == 'opensource' %>
    <% if @collective.tags.count > 0 %>
      <%= line_chart tags_chart_path(collective_slugs: @collective.slug, chart: 'tags', period: @period, exclude_bots: @exclude_bots, range: @range, start_date: @start_date, end_date: @end_date), thousands: ",", title: 'Releases' %>
    <% end %>

    <% if @collective.issues.count > 0 %>
      <h2>Issues</h2>

      <%= render 'issue_charts' %>
    <% else %>
      <p>
        No issues or pull requests found within this period.
      </p>
    <% end %>

    <% if @collective.commits.count > 0 %>
      <h2>Commits</h2>

      <%= render 'commit_charts' %>
    <% else %>
      <p>
        No commits found within this period.
      </p>
    <% end %>

    <% if @projects.any? %>
      <h2>Key Repositories</h2>
      <%= render @collective.key_projects %>

      <% if (@projects - @collective.key_projects).length > 0 %>
        <h2>Other Repositories</h2>

        <%= render @projects - @collective.key_projects %>
        <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>  
      <% end %>
    <% else %>
      <p>
        No repositories found.
      </p>
    <% end %>
  <% end %>

</div>